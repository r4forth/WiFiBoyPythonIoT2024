# 26. 建立網頁伺服器

## 網頁伺服器工作原理


網頁伺服器是負責處理客戶端（通常是網頁瀏覽器）發出的請求，並將所需的網頁或資料返回給客戶端的軟體系統。以下是網頁伺服器工作原理的簡單介紹：

1. 客戶端發出請求

當你在瀏覽器中輸入一個網址並按下 Enter，瀏覽器會產生一個 HTTP 或 HTTPS 請求。這個請求通常包含了想要訪問的資源路徑（如一個網頁）以及所需的其他信息（如使用的 HTTP 方法，常見的有 GET 或 POST）。

2. DNS 解析

請求發出後，瀏覽器會首先與 DNS 伺服器通訊，將用戶輸入的網址（域名）轉換為對應的 IP 位址。這個 IP 位址用來標識網頁伺服器的位置。

3. 與伺服器建立連接

瀏覽器根據解析出的 IP 位址，通過 TCP/IP 協議與目標網頁伺服器建立連接。這通常是在 80（HTTP）或 443（HTTPS）端口上進行的。

4. 伺服器處理請求

網頁伺服器接收到請求後，會根據請求的內容來決定應該返回哪些資源。伺服器可能會從其本地檔案系統中讀取靜態檔案（如 HTML、CSS、JavaScript、圖片等），也可能會執行伺服器端的腳本（如 PHP、Python、Node.js 等）來生成動態內容。

5. 生成並返回響應

網頁伺服器生成對應的 HTTP 響應，響應中包含了狀態碼（例如 200 表示成功，404 表示資源未找到）、標頭（如內容類型、緩存指令等）以及請求的內容。然後，伺服器將這些信息透過之前建立的 TCP 連接發回到客戶端。

6. 客戶端接收並呈現內容

瀏覽器接收到伺服器的響應後，根據 HTML、CSS 和 JavaScript 來解析和呈現網頁。如果網頁中有其他資源（如圖片、外部樣式表或 JavaScript 檔案），瀏覽器會發出額外的 HTTP 請求來獲取這些資源，並最終將整個網頁呈現給用戶。

7. 斷開連接

在響應結束後，伺服器會關閉與客戶端的連接，除非使用了 HTTP/2 或其他支持持久連接的技術，這些技術可以讓多個請求使用同一個連接，減少開銷。


## MicroPython 建立網頁伺服器的模組




## 程式碼


```
# 簡單WebServer 程式
import socket
import wifi

# 設定 WiFi 連線參數
SSID = 'DoraHome300M'
PASSWORD = '0975393503@'

# 連接 WiFi
station = wifi.connect(SSID, PASSWORD)

# 其他主程式邏輯
# 例如：啟動網頁伺服器或其他應用
# 讀取 index.html 檔案的內容
def read_html_file():
    try:
        with open('index.html', 'r') as file:
            return file.read()
    except Exception as e:
        print("無法讀取 index.html 檔案:", e)
        return "<h1>500 Internal Server Error</h1>"

# 建立套接字
addr = socket.getaddrinfo('0.0.0.0', 80)[0][-1]

s = socket.socket()
s.bind(addr)
s.listen(1)

print('伺服器啟動，等待連接...')

while True:
    cl, addr = s.accept()
    print('客戶端連接來自', addr)
    
    # 接收 HTTP 請求
    request = cl.recv(1024)
    print('請求內容:', request)
    
    # 讀取並發送 index.html 檔案的內容
    response = read_html_file()
    
    cl.send('HTTP/1.1 200 OK\r\n')
    cl.send('Content-Type: text/html\r\n')
    cl.send('Connection: close\r\n\r\n')
    cl.sendall(response)
    
    # 關閉連接
    cl.close()
```

## 參考資料

https://github.com/jutnhbr/dln-ble-scanner-for-room-utilization
